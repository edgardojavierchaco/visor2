{% extends 'dashboard/bodydirector.html' %}

{% load static %}

{% block content %}

<head>
    <meta charset="utf-8">
    <title>Resultados de consulta</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.js"></script>
    <style>
        .card {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    {% block content_header %}
            <div class="content-header">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-sm-6">
                                <h1 class="m-0 text-dark">  <small></small></h1>
                            </div>
                            <div class="col-sm-6">
                                <ol class="breadcrumb float-sm-right">
                                    <li class="breadcrumb-item"><a href="{% url 'directores:institucional'%}">Regresar</a><li>                                    
                                    <li class="breadcrumb-item"><a href="{{ list_url }}">{{ entity }}</a></li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
        {% endblock %}
    
    <h5 class="text-left" style="color:red">* Fuente: Relevamiento Anual 2.024</h5>
    
    {% if resultados_detalle%}
        <div>
            {% for resultado in resultados_detalle %}
                <table id="tabla_{{ forloop.counter }}" class="display" style="width:100%">
                    <thead>
                        <tr>
                            {% for encabezado in resultado.encabezados %}
                            <th>{{ encabezado }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for fila in resultado.valores %}
                        <tr>
                            {% for valor in fila %}
                            <td>{{ valor }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot>
                            <tr>
                                <th>Total</th>
                                <th id="totalTotales"></th>
                                
                            </tr>
                        </tfoot>
                </table>
                <script>
                    $(document).ready( function () {
                        $('#tabla_{{ forloop.counter }}').DataTable({
                            responsive: true,
                            autoWidth: false,
                            language: {
                                url: "https://cdn.datatables.net/plug-ins/2.0.3/i18n/es-AR.json" // Ruta al archivo de traducción en español
                            },      
                            dom: '<"top"lBf>rt<"bottom"ip>',
                            buttons: [
                                {
                                    extend: 'excel',
                                    text: '<i class="fas fa-file-excel"></i>',
                                    className: 'btn btn-secondary',
                                    exportOptions: {
                                        columns: ':visible'
                                    },
                                    titleAttr: 'Exportar a Excel',
                                    title: 'Nombre_del_archivo'
                                },
                                {
                                    extend: 'csv',
                                    text: '<i class="fas fa-file-csv"></i>',
                                    className: 'btn btn-secondary',
                                    exportOptions: {
                                        columns: ':visible'
                                    },
                                    titleAttr: 'Exportar a CSV',
                                    title: 'Nombre_del_archivo'
                                },
                                {
                                    extend: 'pdf',
                                    text: '<i class="fas fa-file-pdf"></i>',
                                    className: 'btn btn-secondary',
                                    exportOptions: {
                                        columns: ':visible'
                                    },
                                    titleAttr: 'Exportar a PDF',
                                    title: 'Nombre_del_archivo'
                                },
                                {
                                    extend: 'print',
                                    text: '<i class="fas fa-print"></i>',
                                    className: 'btn btn-secondary',
                                    exportOptions: {
                                        columns: ':visible'
                                    },
                                    titleAttr: 'Imprimir',
                                    title: 'Nombre_del_archivo'
                                }
                            ],
                            footerCallback: function ( row, data, start, end, display ) {
                                var api = this.api();
                                
                                // Total over all pages
                                var totalTotales = api
                                    .column( 5, { search: 'applied'} )
                                    .data()
                                    .reduce( function (a, b) {
                                        return a + parseInt(b || 0);
                                    }, 0 );
                                // Update footer
                                $('#totalTotales').html(totalTotales);
                                
                            }
                        });
                    });
                </script>


            {% endfor %}

        </div>
    {% else %}
        <p class="text-center">No se encontraron resultados para el cueanexo proporcionado.</p>
    {% endif %}

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // Obtener el valor de cueanexo de la URL
        const urlParams = new URLSearchParams(window.location.search);
        const cueanexo = urlParams.get('cueanexo');
    
        // Mostrar el número de cueanexo en el título
        document.getElementById('cueanexo').textContent = cueanexo;
    </script>
    <script>        
        console.log("Resultados_detalle:",{{ resultados_detalle}})
    </script>

</body>
{% endblock %}
