{% extends 'dashboard/bodycenpe.html' %}

{% load static %}

{% block content %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Datos Personal Cenpe</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
        }

        h1 {
            color: #333;
        }

        form {
            max-width: 600px;
            margin: 0 auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table, th, td {
            border: 1px solid #ddd;
        }

        th, td {
            padding: 8px;
            text-align: left;
        }

        button {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        .highlighted-paragraph {
            background-color: #f0f8ff; /* Color de fondo */
            border: 1px solid #ccc; /* Borde del recuadro */
            padding: 15px; /* Espacio interno del recuadro */
            border-radius: 5px; /* Bordes redondeados */
            margin-bottom: 20px; /* Espacio debajo del párrafo */
            font-weight: bold;
        }
        /* Estilos del modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1050;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto; /* Permite desplazamiento si el contenido es largo */
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-dialog {
            background: white;
            border-radius: 8px;
            max-width: 90%;
            width: 600px;
            margin: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .modal-header,
        .modal-footer {
            padding: 15px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-footer {
            border-top: 1px solid #ddd;
            border-bottom: none;
        }

        .modal-body {
            padding: 15px;
            max-height: 60vh; /* Limita la altura del contenido */
            overflow-y: auto; /* Agrega scroll si el contenido es demasiado largo */
        }

        .modal-title {
            margin: 0;
            font-size: 18px;
            font-weight: bold;
        }

        @media (max-width: 600px) {
            .modal-dialog {
                width: 95%;
                margin: 10px;
            }

            .modal-body {
                max-height: 50vh;
            }
        }
    </style>
    <!-- Asegúrate de cargar jQuery antes que Select2 -->
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script> 
    
</head>
<body>
    <h1>Datos Personales ReNPEE</h1>
    <p class="highlighted-paragraph">
        Declaro bajo juramento que todos los datos consignados son veraces. Asimismo, me notifico que cualquier falsedad u omisión dará motivo a las sanciones disciplinarias previstas.
    </p>
    <form method="post">
        {% csrf_token %}
        <table>   
            <tr>                
                <td>{{ form.usuario }}</td>
            </tr>         
            <tr>
                <td>{{ form.apellidos.label_tag }}</td>
                <td>{{ form.apellidos }}</td>
            </tr>
            <tr>
                <td>{{ form.nombres.label_tag }}</td>
                <td>{{ form.nombres }}</td>
            </tr>
            <tr>
                <td>{{ form.dni.label_tag }}</td>
                <td>{{ form.dni }}</td>
            </tr>
            <tr>
                <td>{{ form.cuil.label_tag }}</td>
                <td>{{ form.cuil }}</td>
            </tr>
            <tr>
                <td>{{ form.telfijo.label_tag }}</td>
                <td>{{ form.telfijo }}</td>
            </tr>
            <tr>
                <td>{{ form.celular.label_tag }}</td>
                <td>{{ form.celular }}</td>
            </tr>
            <tr>
                <td>{{ form.f_nac.label_tag }}</td>
                <td>{{ form.f_nac }}</td>
            </tr>
            <tr>
                <td>{{ form.pais_nac.label_tag }}</td>
                <td>{{ form.pais_nac }}</td>
            </tr>
            <tr>
                <td>{{ form.nacionalidad.label_tag }}</td>
                <td>{{ form.nacionalidad }}</td>
            </tr>
            <tr>
                <td>{{ form.t_doc.label_tag }}</td>
                <td>{{ form.t_doc }}</td>
            </tr>
            <tr>
                <td>{{ form.sexo.label_tag }}</td>
                <td>{{ form.sexo }}</td>
            </tr>
            <tr>
                <td>{{ form.estado_civil.label_tag }}</td>
                <td>{{ form.estado_civil }}</td>
            </tr>
            <tr>
                <td>{{ form.nivel_form.label_tag }}</td>
                <td>{{ form.nivel_form }}</td>
            </tr>
            <tr>
                <td>{{ form.prov_nac.label_tag }}</td>
                <td>{{ form.prov_nac }}</td>
            </tr>
            <tr>
                <td>{{ form.loc_nac.label_tag }}</td>
                <td>{{ form.loc_nac }}</td>
            </tr>
            <tr>
                <td>{{ form.prov_resid.label_tag }}</td>
                <td>{{ form.prov_resid }}</td>
            </tr>
            <tr>
                <td>{{ form.loc_resid.label_tag }}</td>
                <td>{{ form.loc_resid }}</td>
            </tr>
            <tr>
                <td>{{ form.calle.label_tag }}</td>
                <td>{{ form.calle }}</td>
            </tr>
            <tr>
                <td>{{ form.nro.label_tag }}</td>
                <td>{{ form.nro }}</td>
            </tr>
            <tr>
                <td>{{ form.mz.label_tag }}</td>
                <td>{{ form.mz }}</td>
            </tr>
            <tr>
                <td>{{ form.pc.label_tag }}</td>
                <td>{{ form.pc }}</td>
            </tr>
            <tr>
                <td>{{ form.casa.label_tag }}</td>
                <td>{{ form.casa }}</td>
            </tr>
            <tr>
                <td>{{ form.piso.label_tag }}</td>
                <td>{{ form.piso }}</td>
            </tr>
            <tr>
                <td>{{ form.uf.label_tag }}</td>
                <td>{{ form.uf }}</td>
            </tr>
            <tr>
                <td>{{ form.barrio.label_tag }}</td>
                <td>{{ form.barrio }}</td>
            </tr>            

        </table>
        {% if form.errors %}
            <div class="errors">
                {{ form.errors }}
            </div>
        {% endif %}
        <button type="submit">Guardar</button>
    </form>
    <!-- Modal de confirmación -->
    <div id="confirmModal" class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirmar Datos Personales</h5>
                    <button type="button" class="close corregir-button" aria-label="Cerrar">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Por favor, verifica los datos ingresados:</p>
                    <ul id="modalDataList"></ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary corregir-button">Corregir</button>
                    <button type="button" id="confirmButton" class="btn btn-primary">Confirmar</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function() {
            // Inicializa Select2
            $('.select2').select2();

            // Maneja el cambio en los selects de provincias
            $('#id_prov_nac').change(function() {
                var provinciaId = $(this).val(); 
                $.ajax({
                    url: "{% url 'cenpe:cargar_localidades' %}",
                    data: {'provincia_id': provinciaId},
                    success: function(data) {
                        $("#id_loc_nac").empty().append('<option value="">Seleccione una localidad</option>');
                        $.each(data, function(key, value) {
                            $("#id_loc_nac").append('<option value="' + value.id + '">' + value.descripcion + '</option>');
                        });
                        $('#id_loc_nac').trigger('change.select2');
                    },
                    error: function(xhr, status, error) {
                        console.error('Error al cargar localidades:', error);
                    }
                });
            });

            $('#id_prov_resid').change(function() {
                var provincia2Id = $(this).val(); 
                $.ajax({
                    url: "{% url 'cenpe:cargar_localidades' %}",
                    data: {'provincia_id': provincia2Id},
                    success: function(data) {
                        $("#id_loc_resid").empty().append('<option value="">Seleccione una localidad</option>');
                        $.each(data, function(key, value) {
                            $("#id_loc_resid").append('<option value="' + value.id + '">' + value.descripcion + '</option>');
                        });
                        $('#id_loc_resid').trigger('change.select2');
                    },
                    error: function(xhr, status, error) {
                        console.error('Error al cargar localidades:', error);
                    }
                });
            });

            // Captura el evento submit del formulario para evitar el envío inmediato
            $('form').on('submit', function(event) {
                event.preventDefault(); // Previene el envío del formulario

                // Llenar el modal con los datos del formulario
                let dataList = $('#modalDataList');
                dataList.empty();

                // Recorre cada campo del formulario y muestra sus valores
                $(this).find('input, select, textarea').each(function() {
                    let label = $(this).closest('tr').find('td:first-child').text(); // Obtiene la etiqueta asociada
                    let value;

                    if ($(this).is('select')) {
                        value = $(this).find('option:selected').text(); // Captura el texto seleccionado en los selects
                    } else if ($(this).is(':checkbox')) {
                        value = $(this).is(':checked') ? 'Sí' : 'No'; // Indica si el checkbox está marcado o no
                    } else {
                        value = $(this).val(); // Captura el valor de los inputs y textareas
                    }

                    if (label && value) {
                        dataList.append(`<li><strong>${label}:</strong> ${value}</li>`); // Muestra la etiqueta y el valor
                    }
                });

                // Mostrar el modal
                $('#confirmModal').addClass('show');
            });

            // Botón Confirmar: envía el formulario
            $('#confirmButton').click(function() {
                $('form')[0].submit(); // Envía el formulario original
            });

            // Botón Corregir: cierra el modal
            $('.corregir-button').click(function() {
                $('#confirmModal').removeClass('show'); // Cierra el modal al quitar la clase 'show'
            });
        });
    </script>


</body>
{% endblock %}
